# 実装計画

[!] タスクが完了したらcheckを付け、完了・未完了を区別してください。

## 🎉 MVP完成（2025-11-05）

基本的なソーシャル機能を備えたMVPが完成しました。

### 実装済み機能
- ✅ 認証システム（ログイン・サインアップ・パスワードリセット）
- ✅ オンボーディング（プロフィール設定・興味タグ選択）
- ✅ 投稿機能（テキスト投稿・タグ付け・削除）
- ✅ リアクション機能（👏、💖、🤣）
- ✅ 通知機能（リアクション通知・未読バッジ）
- ✅ タグ別フィルタリング
- ✅ プロフィールページ（ユーザー情報・投稿履歴表示）

---

- [x] 1. Supabase基本設定と最小限のDB構築
  - Supabaseクライアント設定ファイル（lib/supabase/client.ts、server.ts）を作成する
  - SQLを実行する場合、supabase/migrations/ディレクトリにSQLファイルを作成する
  - 最小限のprofilesテーブルとpostsテーブルの作成SQLを記述する
  - 基本的なRLSポリシーの設定SQLを記述する
  - _要件: 1.1, 2.5_

- [x] 2. 最小限の認証機能
  - 簡単なログイン・サインアップページを作成する
  - Supabase Authと連携した認証処理を実装する
  - 認証状態の基本的な管理を実装する
  - _要件: 1.1, 1.2, 1.4_

- [x] 3. オンボーディング機能
  - 新規ユーザー向けの簡単なオンボーディングフォームを実装する
  - ユーザー名設定とプロフィール作成機能を実装する
  - 興味タグ選択機能を実装する
  - _要件: 5.1, 5.2_

- [x] 4. 基本的なレイアウトとナビゲーション
  - シンプルなヘッダーナビゲーションを実装する
  - サイドバーレイアウトを実装する
  - ログイン状態に応じた表示切り替えを実装する
  - _要件: 7.1_

- [x] 5. 投稿一覧表示（ホームフィード）
  - 投稿一覧を表示するシンプルなPostCardコンポーネントを実装する
  - ホームページで全投稿を新着順で表示する機能を実装する
  - 投稿者名と投稿時間を表示する機能を実装する
  - _要件: 3.4, 3.5_

- [x] 6. 基本的な投稿機能（MVP）
  - シンプルな投稿作成フォームを実装する
  - プレーンテキスト投稿をデータベースに保存する機能を実装する
  - 複数タグ選択機能を実装する（プリセット5種類 + カスタムタグ追加機能）
  - _要件: 2.1, 2.2, 2.3, 2.5_

- [x] 7. 基本的なリアクション機能
  - 3つの基本リアクション（👏、💖、🤣）を実装する
  - リアクション追加・削除の基本機能を実装する
  - リアクション数の表示機能を実装する
  - _要件: 4.1, 4.2, 4.4, 4.5_

- [x] 8. タグ別フィルタリング機能
  - サイドバーに固定タグリストを表示する機能を実装する
  - タグクリック時の投稿フィルタリング機能を実装する
  - タグ別投稿一覧ページを実装する
  - サイドバーに「🏠ホーム」ナビゲーションを追加（すべての投稿に戻る機能）
  - _要件: 3.1, 3.2, 3.3_

- [x] 9. 投稿削除機能
  - 自分の投稿に削除ボタンを表示する機能を実装する
  - 投稿削除の基本機能を実装する
  - 削除権限の制御を実装する
  - _要件: 6.1, 6.3, 6.5_

- [x] 10. 通知機能（基本 + UI）
  - notificationsテーブルをマイグレーションで作成する
  - リアクション時に通知レコードを作成する機能を実装する
  - 通知取得・既読処理のヘルパー関数を実装する
  - Headerに通知ベルアイコンと未読バッジを追加する
  - 通知一覧ドロップダウンコンポーネントを実装する
  - Sidebarに「🔔通知」ナビゲーションを追加（通知ページへのリンク）
  - _要件: 4（リアクション機能）_
  - _備考: リアルタイム通知は将来実装予定（Phase 3）_

- [x] 11. 基本的なエラーハンドリング
  - フォームバリデーション（Zod）を実装する
  - 基本的なエラー表示機能を実装する
  - 認証エラーの処理を実装する
  - _要件: 全般_

- [x] 12. プロフィールページ
  - ユーザープロフィール表示ページを実装する
  - ユーザーの投稿履歴表示機能を実装する
  - デフォルトアバター（イニシャル）を表示する機能を実装する
  - プロフィールページへのリンク（Header、PostCard）を実装する
  - _備考: プロフィール編集機能は将来実装予定_
  - _要件: 5.1, 5.3, 5.4_

---

## Phase 2: 追加機能の実装

MVP完成後に実装する追加機能です。

### 画像投稿機能（Phase 2 - 実装中）

**実装開始日:** 2025-11-07

画像アップロード機能を投稿機能に追加します。以下のタスクを順次実装していきます。

- [x] 13. Supabase Storage設定
  - Supabase Storageで`gazo-images`バケットを作成する
  - RLSポリシーを設定する（投稿者のみ削除可能）
  - 公開URLアクセスを許可する設定を行う
  - _要件: 2（画像投稿機能）_
  - _設計書: design.md - 画像機能の詳細設計 > 1. Supabase Storage 設定_

- [x] 14. 画像ユーティリティ関数の実装
  - `lib/images.ts`を作成する
  - 画像バリデーション関数を実装する（`validateImage()`）
  - 画像リサイズ関数を実装する（`resizeImage()`）
  - 画像アップロード関数を実装する（`uploadImage()`, `uploadImages()`）
  - 画像削除関数を実装する（`deleteImage()`, `deletePostWithImages()`）
  - 画像URL管理関数を実装する（`getImagePathFromUrl()`, `getImageFolderPath()`）
  - _要件: 2（画像投稿機能）_
  - _設計書: design.md - 画像機能の詳細設計 > 2. 画像アップロードフロー_

- [x] 15. 画像アップロードコンポーネント
  - `components/posts/ImageUploader.tsx`を実装する
  - ドラッグ&ドロップアップロード機能を実装する
  - 画像プレビュー表示機能を実装する
  - 画像の削除・差し替え機能を実装する
  - 最大4枚までの複数画像アップロードをサポートする
  - 画像の並び替え機能（ドラッグ&ドロップ）を実装する
  - _要件: 2（画像投稿機能）_
  - _設計書: design.md - 画像機能の詳細設計 > 3. 画像表示コンポーネント設計_

- [x] 16. 投稿フォームへの画像機能統合
  - PostFormコンポーネントにImageUploaderを統合する
  - 投稿作成時の画像アップロード処理を実装する
  - 投稿データに画像URLを含める処理を実装する
  - フォームバリデーションに画像チェックを追加する
  - _要件: 2（画像投稿機能）_
  - _設計書: design.md - 画像機能の詳細設計 > 2. 画像アップロードフロー_

- [ ] 17. 画像表示コンポーネント
  - `components/posts/ImageGallery.tsx`を実装する（レスポンシブグリッド表示）
  - PostCardコンポーネントに画像グリッド表示を統合する
  - 画像枚数に応じたレイアウト切り替えを実装する（1枚/2枚/3枚/4枚）
  - Next.js Imageコンポーネントを使用した最適化を実装する
  - _要件: 2（画像投稿機能）_
  - _設計書: design.md - 画像機能の詳細設計 > 3. 画像表示コンポーネント設計_

- [ ] 18. 画像拡大表示機能
  - `components/posts/ImageLightbox.tsx`を実装する
  - 画像クリック時のライトボックス表示を実装する
  - 画像のスワイプ/矢印ナビゲーションを実装する
  - ESCキーで閉じる機能を実装する
  - 画像インデックス表示を実装する（例: 1/4）
  - _要件: 2（画像投稿機能）_
  - _設計書: design.md - 画像機能の詳細設計 > 3. 画像表示コンポーネント設計_

- [ ] 19. データベーススキーマ更新
  - postsテーブルの`image_urls`カラムが既に存在することを確認する
  - 必要に応じてマイグレーションを作成する
  - TypeScript型定義を更新する（Post型に`image_urls?: string[]`を追加）
  - _要件: 2（画像投稿機能）_
  - _備考: image_urlsカラムは既存スキーマに含まれている可能性あり_

- [ ] 20. 投稿削除時の画像削除処理
  - 投稿削除時に関連画像も削除する処理を実装する
  - `deletePost()` Server Actionを更新する
  - エラーハンドリングを実装する
  - _要件: 6（投稿管理機能）_
  - _設計書: design.md - 投稿API > deletePostWithImages_

- [ ] 21. 画像投稿機能のテストとデプロイ
  - 画像アップロード機能の動作確認を実行する
  - 画像表示機能の動作確認を実行する
  - 画像削除機能の動作確認を実行する
  - レスポンシブ表示の確認を実行する
  - 本番環境へのデプロイと動作確認を実行する
  - _要件: 2（画像投稿機能）_

---

## 将来実装予定の機能

以下のタスクは、画像投稿機能完成後に実装を検討する追加機能です。

### MVPデプロイ

- [ ] 22. 最終調整とMVPデプロイ
  - 全機能の動作確認を実行する
  - Vercelへの基本デプロイを実行する
  - 本番環境での動作確認を実行する
  - _要件: 全般_

### リプライ（返信）機能（Phase 3）

MVP完成後に実装する投稿へのリプライ機能です。Twitter/Instagramのように投稿カードの下にリプライが表示されます。

- [ ] 23. データベーススキーマ更新（リプライ機能）
  - postsテーブルに`parent_post_id`カラム（UUID、NULL許可）を追加するマイグレーションを作成する
  - `parent_post_id`がNULLの場合は通常投稿、値がある場合はリプライとして扱う
  - 外部キー制約を設定する（`parent_post_id REFERENCES posts(id) ON DELETE CASCADE`）
  - インデックスを追加する（`CREATE INDEX idx_posts_parent_post_id ON posts(parent_post_id)`）
  - TypeScript型定義を更新する（Post型に`parent_post_id?: string`を追加）
  - _備考: リプライもpostsテーブルで管理し、スキーマをシンプルに保つ_

- [ ] 24. リプライ作成機能
  - ReplyFormコンポーネントを実装する（テキストのみ、シンプルな入力フォーム）
  - リプライ作成のServer Actionを実装する（`createReply()`）
  - 投稿カードに「返信」ボタンを追加する
  - リプライ作成時にparent_post_idを設定する処理を実装する
  - リプライ投稿時のバリデーションを実装する
  - _備考: 初期実装はテキストのみ、タグは親投稿と同じものを自動設定_

- [ ] 25. リプライ表示機能
  - PostCardコンポーネントにリプライ一覧表示を追加する
  - リプライ取得のヘルパー関数を実装する（`getReplies(postId)`）
  - リプライをネスト表示する（投稿カードの下にぶら下がるレイアウト）
  - リプライ数の表示を追加する
  - _備考: Twitter/Instagram形式、最初は折りたたまれた状態_

- [ ] 26. リプライ通知機能
  - リプライ作成時に通知レコードを作成する機能を実装する
  - notificationsテーブルの`type`に`'reply'`を追加する
  - 通知メッセージ生成ロジックを更新する（「〇〇さんがあなたの投稿に返信しました」）
  - 通知からリプライ元の投稿に遷移する機能を実装する
  - _備考: 既存の通知システムを拡張_

- [ ] 27. リプライへのリアクション機能（将来実装）
  - リプライにもリアクションボタンを表示する
  - リプライへのリアクション数カウント表示を実装する
  - リプライへのリアクション通知を実装する
  - _備考: 基本的なリプライ機能が安定してから実装_

### リアルタイム通知機能（Phase 4）

- [ ] 28. リアルタイム通知機能の実装
  - Supabase Realtimeのセットアップを行う
  - WebSocket接続の管理を実装する
  - クライアントコンポーネントでリアルタイムサブスクリプションを実装する
  - 通知受信時のUI更新を実装する
  - 接続エラーハンドリングを実装する
  - _要件: 4（リアクション機能）_
